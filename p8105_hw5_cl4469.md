p8105_hw5_cl4469
================
Chen Liang
2023-11-12

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(patchwork)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "95%"
)

theme_set(theme_minimal() + theme(legend.position = 'bottom'))

options(
  ggplot2.continuous.colour = 'viridis',
  ggplot2.continuous.fill = 'viridis'
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1

``` r
homicide_df = read.csv("data/homicide-data.csv")
```

This dataset contains 52179 rows and 12 columns, with each row
resprenting a single event occurred. Variables include id,
reported-date, victims’last name,race, and sex. It contains the location
of the killing (city, state, latitude, longitude) and whether an arrest
was made. Moreover, there are some missing values in `lat` and `lon`
columns and unknown information in
`victim_last`,`victim_first`,`victim_age`,`victim_sex`, and
`victim_race`.

``` r
hom_summary = homicide_df|>
  mutate(
    city_state = str_c(city, state, sep = ","),
    resolved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved",
    )) |>
  group_by(city_state) |>
  summarize(
    hom_total = n(),
    hom_unsolved = sum(resolved == "unsolved"),
    home_solved = sum(resolved == "solved")
  )

hom_summary
```

    ## # A tibble: 51 × 4
    ##    city_state     hom_total hom_unsolved home_solved
    ##    <chr>              <int>        <int>       <int>
    ##  1 Albuquerque,NM       378          146         232
    ##  2 Atlanta,GA           973          373         600
    ##  3 Baltimore,MD        2827         1825        1002
    ##  4 Baton Rouge,LA       424          196         228
    ##  5 Birmingham,AL        800          347         453
    ##  6 Boston,MA            614          310         304
    ##  7 Buffalo,NY           521          319         202
    ##  8 Charlotte,NC         687          206         481
    ##  9 Chicago,IL          5535         4073        1462
    ## 10 Cincinnati,OH        694          309         385
    ## # ℹ 41 more rows

``` r
res_tidy = prop.test(
  hom_summary |>filter(city_state == "Baltimore,MD") |> pull(hom_unsolved), 
  hom_summary |>filter(city_state == "Baltimore,MD") |> pull(hom_total)) |>
  broom::tidy(res_tidy)

save(res_tidy, file = "result/prop_test_MD.RData")
```

Pull the estimated proportion and confidence intervals from the
resulting tidy dataframe

``` r
estimated_prop=pull(res_tidy, estimate)
ci=paste("(", pull(res_tidy, conf.low),",", pull(res_tidy, conf.high),")")
```
